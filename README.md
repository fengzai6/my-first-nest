# ç¬¬ä¸€ä¸ª NestJS é¡¹ç›®

<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" /></a>
</p>

<p align="center">
  <a href="https://github.com/fengzai6/my-first-nest/releases/latest">
    <img src="https://img.shields.io/github/v/release/fengzai6/my-first-nest" alt="Release">
  </a>
  <a href="https://github.com/fengzai6/my-first-nest/blob/main/LICENSE">
    <img src="https://img.shields.io/github/license/fengzai6/my-first-nest" alt="License">
  </a>
  <a href="https://github.com/fengzai6/my-first-nest/stargazers">
    <img src="https://img.shields.io/github/stars/fengzai6/my-first-nest" alt="Stars">
  </a>
</p>

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº [NestJS](https://nestjs.com/) æ¡†æ¶çš„å…¥é—¨çº§é¡¹ç›®ï¼Œç”±äºåœ¨è‡ªå­¦nestjsä¹‹è·¯ä¸Šï¼Œé€šè¿‡å®˜æ–¹æ–‡æ¡£å’Œæœç´¢å¼•æ“æ‰€å¾—åˆ°çš„æ•™ç¨‹éƒ½ç‚¹åˆ°ä¸ºæ­¢ï¼Œå¹¶éæ˜¯å®ç°å®é™…åœºæ™¯çš„ä¸šåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä¾¿æƒ³å®Œå–„å®è·µï¼Œå¸®åŠ©å¼€å‘è€…å­¦ä¹ å’Œå®è·µ NestJS çš„åŸºç¡€çŸ¥è¯†ã€‚æœ¬é¡¹ç›®å°†å®ç°ä¸€ä¸ªç®€å•åˆä¸ç®€å•çš„ç³»ç»Ÿï¼Œå±•ç¤º NestJS çš„æ ¸å¿ƒç‰¹æ€§å’Œæœ€ä½³å®è·µï¼ˆä¸ªäººå­¦ä¹ ä¸­ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯ï¼‰ï¼Œå¹¶å°†å°½åŠ›çš„å®Œå–„ç›¸å…³çš„æ³¨é‡Šã€‚åœ¨é¡¹ç›®çš„å„ä¸ªè§’è½æˆ‘ä¹Ÿå¯èƒ½ç•™ä¸‹ç¬”è®°å¸®åŠ©ç†è§£ï½

ç„¶åä¸ºäº†æ›´å¥½çš„å±•ç¤ºé¡¹ç›®åŠŸèƒ½ï¼Œæˆ‘æ·»åŠ äº†å®¢æˆ·ç«¯ï¼ˆé€æ­¥å¯¹æ¥ä¸­ï¼‰ï¼Œæˆ–è®¸ä¹Ÿèƒ½å¸®åŠ©åˆ°å­¦ä¹ å‰ç«¯çš„åŒå­¦ã€‚

å¸Œæœ›è¿™ä¸ªå±äºæˆ‘çš„ç¬¬ä¸€ä¸ª NestJS é¡¹ç›®ï¼Œä¹Ÿèƒ½æˆä¸ºä½ çš„ç¬¬ä¸€ä¸ª NestJS é¡¹ç›®å‚è€ƒğŸ¥°

**é¡¹ç›®ç‰¹ç‚¹ï¼š** `æœ€ä½³å®è·µ` `ä¸¥æ ¼çš„TypeScript` `æŠ€æœ¯ä¸æ—¶ä¿±è¿›` `ä»£ç å¯è¯»æ€§å¼º` `åŠŸèƒ½å®Œå–„` `æŠ€æœ¯æ ˆè¦†ç›–å¹¿æ³›`

## æŠ€æœ¯æ ˆ

- NestJS - æ¸è¿›å¼ Node.js æ¡†æ¶
- TypeScript - ç±»å‹å®‰å…¨çš„ JavaScript è¶…é›†
- TypeORM - å¼ºå¤§çš„ ORM æ¡†æ¶
- PostgreSQL - å…³ç³»å‹æ•°æ®åº“
- Swagger - API æ–‡æ¡£ç”Ÿæˆå·¥å…·
- Redis - ç¼“å­˜

### å®¢æˆ·ç«¯

- React
- Vite
- TailwindCSS
- ShadcnUI

## é¡¹ç›®ç‰¹ç‚¹

- éµå¾ª NestJS æœ€ä½³å®è·µå’Œé¡¹ç›®ç»“æ„
- å®Œæ•´çš„ CRUD æ“ä½œç¤ºä¾‹
- æ¨¡å—åŒ–è®¾è®¡
- ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨
- æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
- åŸºæœ¬çš„è®¤è¯å’Œæˆæƒ

## é¡¹ç›®è·¯çº¿å›¾

### å·²å®ŒæˆåŠŸèƒ½ âœ…

- [x] åŸºç¡€é¡¹ç›®ç»“æ„æ­å»º
- [x] Swagger API æ–‡æ¡£é›†æˆ
- [x] TypeORM æ•°æ®åº“é›†æˆ
- [x] ç”¨æˆ·è´¦å·ç³»ç»Ÿ
- [x] ç”¨æˆ·ç¾¤ç»„ç»“æ„ç®¡ç†
- [x] JWT è®¤è¯ä¸æˆæƒ
- [x] åŒ token è®¤è¯ï¼šAccessToken å’Œ RefreshToken
- [x] æ•°æ®åº“åˆå§‹åŒ–å’Œç›¸å…³è¿ç§»å·¥å…·
  - [x] migration ç”Ÿæˆå·¥å…·
  - [x] æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
  - [x] æ•°æ®åº“ç§å­è„šæœ¬
- [ ] RBAC æƒé™ç®¡ç†
  - [x] æ ¸å¿ƒ RBAC0ï¼šç”¨æˆ·ã€è§’è‰²ã€æƒé™
  - [ ] åˆ†çº§ RBAC1ï¼šè§’è‰²ç»§æ‰¿ï¼Œè§’è‰²å¯ä»¥ç»§æ‰¿ä¸‹çº§è§’è‰²çš„æƒé™
  - [ ] çº¦æŸ RBAC2ï¼šæƒé™çº¦æŸï¼Œå¼ºåˆ¶èŒè´£åˆ†ç¦»ï¼ŒæŸäº›ä»»åŠ¡è¦æ±‚ä¸¤ä¸ªæˆ–å¤šä¸ªè§’è‰²å…±åŒå®Œæˆ
  - [ ] å¯¹ç§° RBAC3ï¼š1 + 2, å¹¶ä¸”å¯ä»¥è·å–ç»„ç»‡æ‹¥æœ‰çš„æƒé™ï¼Œç»§æ‰¿ Groupï¼Œç¦»å¼€ Group åï¼Œæƒé™æ¶ˆå¤±
- [x] é›ªèŠ±ç®—æ³•ä½œä¸º ID ç”Ÿæˆå™¨
- [x] ä½¿ç”¨ joi è¿›è¡Œæ•°æ®éªŒè¯ï¼ˆç¯å¢ƒå˜é‡ï¼‰
- [ ] æ·»åŠ å®¢æˆ·ç«¯æ¥å±•ç¤ºé¡¹ç›®åŠŸèƒ½
  - [ ] ä½¿ç”¨ React & Vite & TailwindCSS & ShadcnUI & Antd åˆ¶ä½œå®¢æˆ·ç«¯

### è®¡åˆ’åŠŸèƒ½ ğŸ“‹

- [ ] Redis ç¼“å­˜é›†æˆ
- [ ] session ç®¡ç†
- [ ] æ—¥å¿—ç³»ç»Ÿå®ç°
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
- [ ] å•å…ƒæµ‹è¯•ä¸ E2E æµ‹è¯•
- [ ] Docker å®¹å™¨åŒ–éƒ¨ç½²
- [ ] å›½é™…åŒ–æ”¯æŒï¼Œç»Ÿä¸€ç®¡ç†å“åº”ä¿¡æ¯ï¼Œå¹¶æ ¹æ®ç”¨æˆ·è¯­è¨€è¿”å›ä¸åŒçš„å¤šè¯­è¨€
- [ ] æ¥å£é™æµï¼ˆå…¨å±€æˆ–è€…æŒ‡å®šé…ç½®ï¼‰
- [ ] ç¬¬ä¸‰æ–¹ç™»å½•é›†æˆï¼šGitHubç­‰
- [ ] WebSocket å®æ—¶é€šä¿¡
- [ ] sse å®æ—¶é€šä¿¡
- [ ] ä½¿ç”¨æ–‡æ¡£åˆ¶ä½œ
  - [ ] ä½¿ç”¨ Vitepress/Docusaurus åˆ¶ä½œé¡¹ç›®æ–‡æ¡£
- [ ] github action è‡ªåŠ¨åŒ–éƒ¨ç½²
  - [ ] éƒ¨ç½²æ–‡æ¡£é¡µé¢

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js (>= 20.19.3)
- npm æˆ– yarn
- PostgreSQL

### å®‰è£…ä¾èµ–

```bash
$ yarn install
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` æ–‡ä»¶ä¸º `.env`ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ï¼š

```bash
$ cp .env.example .env
```

### è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼
$ yarn start:dev

# ç”Ÿäº§æ¨¡å¼
$ yarn start:prod
```

#### åˆå§‹åŒ–æ•°æ®åº“

```bash
$ yarn db:init
```

#### æ•°æ®åº“ç”Ÿæˆè¿ç§»

```bash
$ yarn migration:generate <migration_name>
```

#### å®¢æˆ·ç«¯

```bash
$ cd client
$ yarn install
$ yarn dev
```

## Docker

é¡¹ç›®å†…ç½®äº† Docker æ”¯æŒï¼Œæ–¹ä¾¿æ‚¨å¿«é€Ÿå¯åŠ¨å’Œéƒ¨ç½²åº”ç”¨ã€‚

### å¯åŠ¨æœåŠ¡

1.  **å¯åŠ¨æ•°æ®åº“æœåŠ¡**
    æ­¤å‘½ä»¤ä¼šå¯åŠ¨ä¸€ä¸ª PostgreSQL æ•°æ®åº“å®¹å™¨ï¼Œå¹¶å°†æ•°æ®æŒä¹…åŒ–åˆ° `dockerå†…çš„pg-data` ç›®å½•ã€‚

    ```bash
    docker-compose -f docker-compose.db.yml up -d
    ```

2.  **å¯åŠ¨åº”ç”¨æœåŠ¡**
    - **æ–¹å¼ä¸€ï¼šé€šè¿‡ Compose æ„å»ºå’Œè¿è¡Œ**
      æ­¤å‘½ä»¤ä¼šè‡ªåŠ¨æ„å»ºå‰åç«¯ï¼Œå¹¶å¯åŠ¨åº”ç”¨å®¹å™¨ã€‚

      ```bash
      docker-compose -f docker-compose.app.yml up --build -d
      ```

    - **æ–¹å¼äºŒï¼šè¿è¡Œæœ¬åœ°å·²æ„å»ºçš„é•œåƒ**
      é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰‹åŠ¨æ„å»ºé•œåƒï¼š
      ```bash
      docker build -t my-first-nest-app:local .
      ```
      ç„¶åï¼Œä½¿ç”¨ `local` compose æ–‡ä»¶å¯åŠ¨å®ƒï¼š
      ```bash
      docker-compose -f docker-compose.local.yml up -d
      ```

### åœæ­¢æœåŠ¡

è¦åœæ­¢æ‰€æœ‰æœåŠ¡å¹¶ç§»é™¤å®¹å™¨ï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
# åœæ­¢å¹¶ç§»é™¤æ•°æ®åº“
docker-compose -f docker-compose.db.yml down

# åœæ­¢å¹¶ç§»é™¤åº”ç”¨
docker-compose -f docker-compose.app.yml down
# æˆ–è€…
docker-compose -f docker-compose.local.yml down
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ database/                   # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ migrations/             # TypeORM è¿ç§»æ–‡ä»¶
â”‚   â””â”€â”€ seeds/                  # æ•°æ®å¡«å……è„šæœ¬ (åˆå§‹åŒ–æ•°æ®)
â”œâ”€â”€ Dockerfile                  # Docker é…ç½®æ–‡ä»¶
â”œâ”€â”€ scripts/                    # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ src/                        # é¡¹ç›®æºç 
â”‚   â”œâ”€â”€ app.module.ts           # åº”ç”¨æ ¹æ¨¡å—
â”‚   â”œâ”€â”€ app.controller.ts       # åº”ç”¨æ ¹æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ app.service.ts          # åº”ç”¨æ ¹æœåŠ¡
â”‚   â”œâ”€â”€ main.ts                 # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ common/                 # å…¨å±€é€šç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ constants/          # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ context/            # è¯·æ±‚ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ decorators/         # è‡ªå®šä¹‰è£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ exceptions/         # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ filters/            # å…¨å±€è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ guards/             # å…¨å±€å®ˆå«
â”‚   â”‚   â”œâ”€â”€ interceptors/       # å…¨å±€æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ pipes/              # å…¨å±€ç®¡é“
â”‚   â”‚   â”œâ”€â”€ response/           # é€šç”¨å“åº”ç»“æ„
â”‚   â”‚   â””â”€â”€ subscribers/        # æ•°æ®åº“è®¢é˜…å™¨
â”‚   â”œâ”€â”€ config/                 # é…ç½®æ¨¡å— (ç¯å¢ƒå˜é‡ç­‰)
â”‚   â”œâ”€â”€ modules/                # ä¸šåŠ¡åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth/               # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ cats/               # ç¤ºä¾‹æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ groups/             # ç¾¤ç»„æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ permissions/        # æƒé™æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ roles/              # è§’è‰²æ¨¡å—
â”‚   â”‚   â””â”€â”€ users/              # ç”¨æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ shared/                 # å…±äº«æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“è¿æ¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ entity/             # åŸºç¡€å®ä½“ç±» (å¦‚ï¼šå®¡è®¡å­—æ®µ)
â”‚   â”‚   â”œâ”€â”€ static/             # é™æ€èµ„æºæ¨¡å—
â”‚   â”‚   â””â”€â”€ utils/              # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ types/                  # TypeScript ç±»å‹å®šä¹‰
â””â”€â”€ test/                       # æµ‹è¯•
```

æ¯ä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆå¦‚ `users`ã€`groups` ç­‰ï¼‰é€šå¸¸åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```
modules/xxx/
â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡ (Data Transfer Objects)
â”œâ”€â”€ entities/       # TypeORM å®ä½“
â”œâ”€â”€ xxx.controller.ts  # æ§åˆ¶å™¨ (å¤„ç†è·¯ç”±å’Œ HTTP è¯·æ±‚)
â”œâ”€â”€ xxx.service.ts    # æœåŠ¡ (å¤„ç†ä¸šåŠ¡é€»è¾‘)
â””â”€â”€ xxx.module.ts     # æ¨¡å—å®šä¹‰ (ç»„ç»‡æ¨¡å—ä¾èµ–)
```

## å¼€å‘è§„èŒƒ

- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- éµå¾ª RESTful API è®¾è®¡è§„èŒƒ
- ä½¿ç”¨ DTO è¿›è¡Œæ•°æ®éªŒè¯
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- è§„èŒƒçš„ä»£ç æ³¨é‡Š
- ä½¿ç”¨ ESLint å’Œ Prettier ä¿æŒä»£ç é£æ ¼ä¸€è‡´
- ä½¿ç”¨ husky å’Œ commitlint è¿›è¡Œ commit è§„èŒƒ

## å­¦ä¹ èµ„æº

- [NestJS å®˜æ–¹æ–‡æ¡£](https://docs.nestjs.com)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/docs)
- [TypeORM æ–‡æ¡£](https://typeorm.io)

## å¸Œæœ›å„ä½å¸…å“¥ç¾å¥³

ä¸ºäº†å®ç°æœ€ä½³å®è·µï¼Œå¯ä»¥é€šè¿‡ issue æå‡ºåŒ…æ‹¬ä½†ä¸é™äºï¼š

- ä»£ç è§„èŒƒï¼ˆå¦‚ï¼šå‘½åè§„èŒƒã€æ³¨é‡Šè§„èŒƒã€ä»£ç é£æ ¼ç­‰ï¼‰
- é¡¹ç›®ç»“æ„ï¼ˆå¦‚ï¼šæ¨¡å—åˆ’åˆ†ã€ç›®å½•ç»“æ„ã€æ–‡ä»¶å‘½åç­‰ï¼‰
- åŠŸèƒ½å®ç°ï¼ˆå¦‚ï¼šåŠŸèƒ½å®ç°ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨é—®é¢˜ç­‰ï¼‰

çš„å»ºè®®ï¼Œé€šè¿‡è¯„ä¼°å’Œè®¨è®ºï¼Œæˆ‘ä¼šå°½åŠ›æ ¹æ®å»ºè®®å®Œå–„é¡¹ç›®ã€‚

ä¹Ÿå¯ä»¥é€šè¿‡ PR ç›´æ¥æäº¤æ‚¨çš„æœ€ä½³å®è·µä»£ç ï¼Œæäº¤ PR ä¹‹å‰ï¼Œè¯·å…ˆåˆ›å»ºä¸€ä¸ª issueï¼Œå¹¶æè¿°æ‚¨çš„æœ€ä½³å®è·µã€‚å¹¶è‡ªå·±è®¤é¢† issue ï¼ˆæ¯ä¸ªäººéƒ½å¯ä»¥åœ¨åˆ«äººçš„ issue ä¸­è®¤é¢†å¹¶è¿›è¡Œå¼€å‘ï¼‰ï¼Œåœ¨ç»è¿‡è¯„ä¼°å’Œè®¨è®ºå’Œå®Œæˆä¹‹åï¼Œæˆ‘ä¼šåˆå¹¶æ‚¨çš„ PRã€‚

æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼

## è®¸å¯è¯

[MIT licensed](LICENSE)
